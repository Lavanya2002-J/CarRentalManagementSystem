@{
    ViewData["Title"] = "Customer Dashboard";
    ViewBag.Username = "Customer";
    ViewBag.ActiveBookingsCount = 3;
}

<link rel="stylesheet" href="~/css/CDB.css" asp-append-version="true" />

<div class="container py-4">

    <h1 class="h2 mb-4">My Dashboard</h1>

    <div class="dashboard-header mb-4 glass-effect">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="mb-1">Hello, @ViewBag.Username!</h1>
                <p class="text-muted">Welcome back. Here you can manage your bookings and personal information.</p>
            </div>
            <div class="col-lg-4 d-flex justify-content-lg-end">
                <div class="stat-box w-100 text-center">
                    <div class="stat-number">@ViewBag.ActiveBookingsCount</div>
                    <div class="stat-label">Active Rentals</div>
                </div>
            </div>
        </div>
    </div>

    <div class="alert alert-info alert-dismissible fade show glass-effect" role="alert">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Quick Tip:</strong> Planning a long trip around Sri Lanka? Check out our weekly rental plans for extra savings!
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-2">

        <div class="col">
            <div class="card h-100 dashboard-card card-bookings">
                <div class="card-overlay"></div>
                <div class="card-body">
                    <h5>My Bookings</h5>
                    <p>Review your active and past rental agreements.</p>
                    <div class="mt-auto">
                        <a asp-controller="Booking" asp-action="History" class="btn btn-primary fw-bold">View History</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 dashboard-card card-find-car">
                <div class="card-overlay"></div>
                <div class="card-body">
                    <h5>Find a Car</h5>
                    <p>Explore our collection and book your next vehicle.</p>
                    <div class="mt-auto">
                        <a asp-controller="Home" asp-action="Index" class="btn btn-success fw-bold">Browse & Book Now</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 dashboard-card card-profile">
                <div class="card-overlay"></div>
                <div class="card-body">
                    <h5>Manage Profile</h5>
                    <p>Update your personal information and preferences.</p>
                    <div class="mt-auto">
                        <a asp-controller="Account" asp-action="Profile" class="btn btn-secondary fw-bold">Update Profile</a>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Scripts to make the Dashboard interactive
        document.addEventListener('DOMContentLoaded', function() {
            const statNumberEl = document.querySelector('.stat-number');
            if (statNumberEl) {
                const targetNumber = parseInt(statNumberEl.textContent, 10);
                statNumberEl.textContent = '0';
                const animateCounter = (target, duration) => {
                    let start = 0;
                    const increment = target / (duration / 16);
                    const updateCount = () => {
                        start += increment;
                        if (start < target) {
                            statNumberEl.textContent = Math.ceil(start);
                            requestAnimationFrame(updateCount);
                        } else {
                            statNumberEl.textContent = target;
                        }
                    };
                    requestAnimationFrame(updateCount);
                };
                animateCounter(targetNumber, 1000);
            }
        });

        // Your existing function for previewing images
        function previewImage(event, previewId) {
            const imageInput = event.target;
            const previewContainer = document.getElementById(previewId);
            if (!previewContainer) {
                console.error(`Error: Preview container with ID "${previewId}" not found.`);
                return;
            }
            const previewText = previewContainer.querySelector('span');
            const file = imageInput.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file (e.g., JPG, PNG).');
                    imageInput.value = "";
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContainer.style.backgroundImage = `url(${e.target.result})`;
                    if (previewText) {
                        previewText.style.display = 'none';
                    }
                };
                reader.readAsDataURL(file);
            } else {
                previewContainer.style.backgroundImage = 'none';
                if (previewText) {
                    previewText.style.display = 'block';
                }
            }
        }
    </script>
}