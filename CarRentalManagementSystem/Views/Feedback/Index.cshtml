@using CarRentalManagementSystem.Models
@model IEnumerable<Feedback>

@{
    ViewData["Title"] = "Customer Feedback";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var customers = ViewBag.Customers as Dictionary<int, string> ?? new Dictionary<int, string>();
    var cars = ViewBag.Cars as Dictionary<Guid, string> ?? new Dictionary<Guid, string>();
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="~/css/CustomerFeedback.css" asp-append-version="true" />

<div class="container mt-5">
    <div class="page-header mb-4">
        <h1 class="fw-bold"><i class="bi bi-chat-quote-fill me-2" style="color:#00d9ff;"></i>@ViewData["Title"]</h1>
        <p>Here you can view all feedback submitted by customers.</p>
    </div>

    <div class="glass-panel rounded-3 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-glass align-middle mb-0">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Car</th>
                        <th class="text-center">Rating</th>
                        <th>Feedback</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@(customers.GetValueOrDefault(item.CustomerID, "N/A"))</td>
                                <td>@(cars.GetValueOrDefault(item.CarID, "N/A"))</td>
                                <td class="text-center">
                                    @{
                                        // Extracts the first digit from the rating string, e.g., '5' from "5 Stars - Excellent"
                                        var ratingValue = item.Ratings?.FirstOrDefault(char.IsDigit).ToString() ?? "0";
                                    }
                                    <span class="rating-stars" data-rating="@ratingValue" title="@item.Ratings"></span>
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.FeedBack)</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr class="no-items-row">
                            <td colspan="4" class="text-center p-4">No feedback has been submitted yet.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}